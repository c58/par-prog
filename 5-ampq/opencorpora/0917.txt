Захотелось мне добавить к моей долго работающей программе (для дипломной работы) какую-нибудь приемлемую индикацию прогресса работы. Т.е., программа работает себе (вычисляет какую-то свою полезную вещь), и в это время на экране должен отображаться прогресс-бар, который показывает, какая работа сейчас выполняется, какая часть работы сделана и показывает, сколько времени еще осталось до завершения.
На самом деле, так как программа сложная, то нужен не один прогресс-бар, а иерархия прогресс-баров: каждый прогресс-бар нижнего уровня показывает, какая часть работы верхнего уровня сделана.
В итоге, внешний вид получился вот таким:
Сделано очень просто: есть два макроса — with-progress-bar и with-progress-bar-action. Первый макрос навешивается вокруг кода, который выполняет некую работу; в момент начала выполнения кода показывается прогресс-бар, а в момент завершения кода прогресс-бар убирается. Второй макрос навешивается вокруг кода, совершающего некоторую логическую часть работы; в момент завершения выполнения кода содержимое прогресс-бара обновляется и вычисляется оценка времени, которое займет выполнение работы.
Чтобы этот UI не мешал основной программе и не зависал, он запускается в другом потоке.
Примерный use-case:
Помню, когда надо было реализовать аналогичное (и гораздо более простое) отображение прогресса на C#, это заняло у меня где-то полдня. На лиспе же я написал это за полчаса. Хорошее соотношение затраченного времени, я считаю.
